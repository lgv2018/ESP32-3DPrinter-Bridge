/*

  ESP32-3DPrinter-Bridge - A network <=> ESP32 <=> USB (FTDI) <=> 3D printer bridge
  Source: https://github.com/tobozo/ESP32-3DPrinter-Bridge
 
  MIT License

  Copyright (c) 2018 tobozo

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to deal
  in the Software without restriction, including without limitation the rights
  to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
  copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in all
  copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
  OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
  SOFTWARE.

  -----------------------------------------------------------------------------

*/

#ifndef __GCODE_H
#define __GCODE_H

#define GCODE_LEN 489
String imperial_march[GCODE_LEN] = {
  "M300 S392 P436",
  "M300 S0 P109",
  "M300 S392 P436",
  "M300 S0 P109",
  "M300 S392 P436",
  "M300 S0 P109",
  "M300 S311 P326",
  "M300 S0 P81",
  "M300 S466 P108",
  "M300 S0 P27",
  "M300 S392 P436",
  "M300 S0 P109",
  "M300 S311 P326",
  "M300 S0 P81",
  "M300 S466 P108",
  "M300 S0 P27",
  "M300 S392 P872",
  "M300 S0 P218",
  "M300 S587 P436",
  "M300 S0 P109",
  "M300 S587 P436",
  "M300 S0 P109",
  "M300 S587 P436",
  "M300 S0 P109",
  "M300 S622 P326",
  "M300 S0 P81",
  "M300 S466 P108",
  "M300 S0 P27",
  "M300 S370 P436",
  "M300 S0 P109",
  "M300 S311 P326",
  "M300 S0 P81",
  "M300 S466 P108",
  "M300 S0 P27",
  "M300 S392 P872",
  "M300 S0 P218",
  "M300 S784 P436",
  "M300 S0 P109",
  "M300 S392 P326",
  "M300 S0 P81",
  "M300 S392 P108",
  "M300 S0 P27",
  "M300 S784 P436",
  "M300 S0 P109",
  "M300 S740 P326",
  "M300 S0 P81",
  "M300 S698 P108",
  "M300 S0 P27",
  "M300 S659 P108",
  "M300 S0 P27",
  "M300 S622 P108",
  "M300 S0 P27",
  "M300 S659 P217",
  "M300 S0 P54",
  "M300 S0 P436",
  "M300 S0 P109",
  "M300 S415 P217",
  "M300 S0 P54",
  "M300 S554 P436",
  "M300 S0 P109",
  "M300 S523 P326",
  "M300 S0 P81",
  "M300 S494 P108",
  "M300 S0 P27",
  "M300 S466 P108",
  "M300 S0 P27",
  "M300 S440 P108",
  "M300 S0 P27",
  "M300 S466 P217",
  "M300 S0 P54",
  "M300 S0 P436",
  "M300 S0 P109",
  "M300 S311 P217",
  "M300 S0 P54",
  "M300 S370 P436",
  "M300 S0 P109",
  "M300 S311 P326",
  "M300 S0 P81",
  "M300 S370 P108",
  "M300 S0 P27",
  "M300 S466 P436",
  "M300 S0 P109",
  "M300 S392 P326",
  "M300 S0 P81",
  "M300 S466 P108",
  "M300 S0 P27",
  "M300 S587 P872",
  "M300 S0 P218",
  "M300 S784 P436",
  "M300 S0 P109",
  "M300 S392 P326",
  "M300 S0 P81",
  "M300 S392 P108",
  "M300 S0 P27",
  "M300 S784 P436",
  "M300 S0 P109",
  "M300 S740 P326",
  "M300 S0 P81",
  "M300 S698 P108",
  "M300 S0 P27",
  "M300 S659 P108",
  "M300 S0 P27",
  "M300 S622 P108",
  "M300 S0 P27",
  "M300 S659 P217",
  "M300 S0 P54",
  "M300 S0 P436",
  "M300 S0 P109",
  "M300 S415 P217",
  "M300 S0 P54",
  "M300 S554 P436",
  "M300 S0 P109",
  "M300 S523 P326",
  "M300 S0 P81",
  "M300 S494 P108",
  "M300 S0 P27",
  "M300 S466 P108",
  "M300 S0 P27",
  "M300 S440 P108",
  "M300 S0 P27",
  "M300 S466 P217",
  "M300 S0 P54",
  "M300 S0 P436",
  "M300 S0 P109",
  "M300 S311 P217",
  "M300 S0 P54",
  "M300 S370 P436",
  "M300 S0 P109",
  "M300 S311 P326",
  "M300 S0 P81",
  "M300 S466 P108",
  "M300 S0 P27",
  "M300 S392 P436",
  "M300 S0 P109",
  "M300 S311 P326",
  "M300 S0 P81",
  "M300 S466 P108",
  "M300 S0 P27",
  "M300 S392 P872",
  "M300 S0 P218",
  "M300 S392 P436",
  "M300 S0 P109",
  "M300 S392 P436",
  "M300 S0 P109",
  "M300 S392 P436",
  "M300 S0 P109",
  "M300 S311 P326",
  "M300 S0 P81",
  "M300 S466 P108",
  "M300 S0 P27",
  "M300 S392 P436",
  "M300 S0 P109",
  "M300 S311 P326",
  "M300 S0 P81",
  "M300 S466 P108",
  "M300 S0 P27",
  "M300 S392 P872",
  "M300 S0 P218",
  "M300 S587 P436",
  "M300 S0 P109",
  "M300 S587 P436",
  "M300 S0 P109",
  "M300 S587 P436",
  "M300 S0 P109",
  "M300 S622 P326",
  "M300 S0 P81",
  "M300 S466 P108",
  "M300 S0 P27",
  "M300 S370 P436",
  "M300 S0 P109",
  "M300 S311 P326",
  "M300 S0 P81",
  "M300 S466 P108",
  "M300 S0 P27",
  "M300 S392 P872",
  "M300 S0 P218",
  "M300 S784 P436",
  "M300 S0 P109",
  "M300 S392 P326",
  "M300 S0 P81",
  "M300 S392 P108",
  "M300 S0 P27",
  "M300 S784 P436",
  "M300 S0 P109",
  "M300 S740 P326",
  "M300 S0 P81",
  "M300 S698 P108",
  "M300 S0 P27",
  "M300 S659 P108",
  "M300 S0 P27",
  "M300 S622 P108",
  "M300 S0 P27",
  "M300 S659 P217",
  "M300 S0 P54",
  "M300 S0 P436",
  "M300 S0 P109",
  "M300 S415 P217",
  "M300 S0 P54",
  "M300 S554 P436",
  "M300 S0 P109",
  "M300 S523 P326",
  "M300 S0 P81",
  "M300 S494 P108",
  "M300 S0 P27",
  "M300 S466 P108",
  "M300 S0 P27",
  "M300 S440 P108",
  "M300 S0 P27",
  "M300 S466 P217",
  "M300 S0 P54",
  "M300 S0 P436",
  "M300 S0 P109",
  "M300 S311 P217",
  "M300 S0 P54",
  "M300 S370 P436",
  "M300 S0 P109",
  "M300 S311 P326",
  "M300 S0 P81",
  "M300 S466 P108",
  "M300 S0 P27",
  "M300 S392 P436",
  "M300 S0 P109",
  "M300 S311 P326",
  "M300 S0 P81",
  "M300 S466 P108",
  "M300 S0 P27",
  "M300 S392 P872",
  "M300 S0 P218",
  "M300 S0 P436",
  "M300 S0 P109",
  "M300 S294 P217",
  "M300 S0 P54",
  "M300 S311 P217",
  "M300 S0 P54",
  "M300 S262 P217",
  "M300 S0 P54",
  "M300 S0 P436",
  "M300 S0 P109",
  "M300 S466 P217",
  "M300 S0 P54",
  "M300 S440 P217",
  "M300 S0 P54",
  "M300 S370 P217",
  "M300 S0 P54",
  "M300 S587 P217",
  "M300 S0 P54",
  "M300 S554 P217",
  "M300 S0 P54",
  "M300 S440 P217",
  "M300 S0 P54",
  "M300 S523 P217",
  "M300 S0 P54",
  "M300 S466 P217",
  "M300 S0 P54",
  "M300 S370 P217",
  "M300 S0 P54",
  "M300 S311 P217",
  "M300 S0 P54",
  "M300 S0 P436",
  "M300 S0 P109",
  "M300 S294 P217",
  "M300 S0 P54",
  "M300 S311 P217",
  "M300 S0 P54",
  "M300 S262 P217",
  "M300 S0 P54",
  "M300 S0 P436",
  "M300 S0 P109",
  "M300 S466 P217",
  "M300 S0 P54",
  "M300 S440 P217",
  "M300 S0 P54",
  "M300 S370 P217",
  "M300 S0 P54",
  "M300 S784 P217",
  "M300 S0 P54",
  "M300 S587 P217",
  "M300 S0 P54",
  "M300 S466 P217",
  "M300 S0 P54",
  "M300 S415 P217",
  "M300 S0 P54",
  "M300 S311 P217",
  "M300 S0 P54",
  "M300 S247 P217",
  "M300 S0 P54",
  "M300 S208 P217",
  "M300 S0 P54",
  "M300 S0 P436",
  "M300 S0 P109",
  "M300 S294 P217",
  "M300 S0 P54",
  "M300 S311 P217",
  "M300 S0 P54",
  "M300 S262 P217",
  "M300 S0 P54",
  "M300 S0 P436",
  "M300 S0 P109",
  "M300 S466 P217",
  "M300 S0 P54",
  "M300 S440 P217",
  "M300 S0 P54",
  "M300 S370 P217",
  "M300 S0 P54",
  "M300 S587 P217",
  "M300 S0 P54",
  "M300 S554 P217",
  "M300 S0 P54",
  "M300 S440 P217",
  "M300 S0 P54",
  "M300 S523 P217",
  "M300 S0 P54",
  "M300 S466 P217",
  "M300 S0 P54",
  "M300 S370 P217",
  "M300 S0 P54",
  "M300 S311 P217",
  "M300 S0 P54",
  "M300 S0 P436",
  "M300 S0 P109",
  "M300 S311 P217",
  "M300 S0 P54",
  "M300 S330 P217",
  "M300 S0 P54",
  "M300 S277 P217",
  "M300 S0 P54",
  "M300 S0 P436",
  "M300 S0 P109",
  "M300 S494 P217",
  "M300 S0 P54",
  "M300 S466 P217",
  "M300 S0 P54",
  "M300 S392 P217",
  "M300 S0 P54",
  "M300 S831 P217",
  "M300 S0 P54",
  "M300 S622 P217",
  "M300 S0 P54",
  "M300 S494 P217",
  "M300 S0 P54",
  "M300 S440 P217",
  "M300 S0 P54",
  "M300 S330 P217",
  "M300 S0 P54",
  "M300 S262 P217",
  "M300 S0 P54",
  "M300 S220 P217",
  "M300 S0 P54",
  "M300 S440 P436",
  "M300 S0 P109",
  "M300 S440 P436",
  "M300 S0 P109",
  "M300 S440 P436",
  "M300 S0 P109",
  "M300 S349 P326",
  "M300 S0 P81",
  "M300 S523 P108",
  "M300 S0 P27",
  "M300 S440 P436",
  "M300 S0 P109",
  "M300 S349 P326",
  "M300 S0 P81",
  "M300 S523 P108",
  "M300 S0 P27",
  "M300 S440 P872",
  "M300 S0 P218",
  "M300 S659 P436",
  "M300 S0 P109",
  "M300 S659 P436",
  "M300 S0 P109",
  "M300 S659 P436",
  "M300 S0 P109",
  "M300 S698 P326",
  "M300 S0 P81",
  "M300 S523 P108",
  "M300 S0 P27",
  "M300 S415 P436",
  "M300 S0 P109",
  "M300 S349 P326",
  "M300 S0 P81",
  "M300 S523 P108",
  "M300 S0 P27",
  "M300 S440 P872",
  "M300 S0 P218",
  "M300 S880 P436",
  "M300 S0 P109",
  "M300 S440 P326",
  "M300 S0 P81",
  "M300 S440 P108",
  "M300 S0 P27",
  "M300 S880 P436",
  "M300 S0 P109",
  "M300 S831 P326",
  "M300 S0 P81",
  "M300 S784 P108",
  "M300 S0 P27",
  "M300 S740 P108",
  "M300 S0 P27",
  "M300 S698 P108",
  "M300 S0 P27",
  "M300 S740 P217",
  "M300 S0 P54",
  "M300 S0 P436",
  "M300 S0 P109",
  "M300 S466 P217",
  "M300 S0 P54",
  "M300 S622 P436",
  "M300 S0 P109",
  "M300 S587 P326",
  "M300 S0 P81",
  "M300 S554 P108",
  "M300 S0 P27",
  "M300 S523 P108",
  "M300 S0 P27",
  "M300 S494 P108",
  "M300 S0 P27",
  "M300 S523 P217",
  "M300 S0 P54",
  "M300 S0 P436",
  "M300 S0 P109",
  "M300 S349 P217",
  "M300 S0 P54",
  "M300 S415 P436",
  "M300 S0 P109",
  "M300 S349 P326",
  "M300 S0 P81",
  "M300 S523 P108",
  "M300 S0 P27",
  "M300 S440 P436",
  "M300 S0 P109",
  "M300 S349 P326",
  "M300 S0 P81",
  "M300 S523 P108",
  "M300 S0 P27",
  "M300 S440 P872",
  "M300 S0 P218",
  "M300 S880 P436",
  "M300 S0 P109",
  "M300 S440 P326",
  "M300 S0 P81",
  "M300 S440 P108",
  "M300 S0 P27",
  "M300 S880 P436",
  "M300 S0 P109",
  "M300 S831 P326",
  "M300 S0 P81",
  "M300 S784 P108",
  "M300 S0 P27",
  "M300 S740 P108",
  "M300 S0 P27",
  "M300 S698 P108",
  "M300 S0 P27",
  "M300 S740 P217",
  "M300 S0 P54",
  "M300 S0 P436",
  "M300 S0 P109",
  "M300 S466 P217",
  "M300 S0 P54",
  "M300 S622 P436",
  "M300 S0 P109",
  "M300 S587 P326",
  "M300 S0 P81",
  "M300 S554 P108",
  "M300 S0 P27",
  "M300 S523 P108",
  "M300 S0 P27",
  "M300 S494 P108",
  "M300 S0 P27",
  "M300 S523 P217",
  "M300 S0 P54",
  "M300 S0 P436",
  "M300 S0 P109",
  "M300 S349 P217",
  "M300 S0 P54",
  "M300 S415 P436",
  "M300 S0 P109",
  "M300 S349 P326",
  "M300 S0 P81",
  "M300 S523 P108",
  "M300 S0 P27",
  "M300 S440 P436",
  "M300 S0 P109",
  "M300 S349 P326",
  "M300 S0 P81",
  "M300 S523 P108",
  "M300 S0 P27",
  "M300 S440 P653",
  "M300 S0 P163",
  ""
};


uint16_t GCodeIndex = 0;
bool playing = false;
unsigned long nextnote = millis();
uint16_t GCodeOffset = 0;
uint16_t maxstrlength = 32;

String imperialMarchAsString(bool async) {
  if(GCodeOffset>=GCODE_LEN-2) {
    playing = false;
    GCodeOffset = 0;
    if(!async) return "";
    return "M29 blah.g\r\nM32 blah.g";
  }
  String GNote = "********************";
  int strlength = 0;
  int totallength = 0;
  String out = "";
  unsigned long fullduration = 0;
  for(uint16_t i=GCodeOffset;i<GCODE_LEN-1;i++) {
    GCodeOffset = i;
    GNote = imperial_march[GCodeOffset];

    int PPos = GNote.indexOf('P');
    String SDuration = GNote.substring(PPos+1);
    SDuration.trim();
    unsigned int PDuration = SDuration.toInt();
    
    GNote += "\r\n";
    strlength = sizeof(GNote);
    if(totallength + strlength > maxstrlength) {
      return out;
    }
    totallength += strlength;
    fullduration += PDuration;
    nextnote = millis() + fullduration;
    out += GNote;
  }
  return out;
}

#endif
